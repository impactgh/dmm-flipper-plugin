package com.dmmflipper;

import lombok.extern.slf4j.Slf4j;
import net.runelite.client.ui.PluginPanel;
import net.runelite.client.ui.ColorScheme;
import net.runelite.client.util.QuantityFormatter;

import javax.swing.*;
import javax.swing.border.EmptyBorder;
import java.awt.*;
import java.util.ArrayList;
import java.util.List;

@Slf4j
public class DMMFlipperPanel extends PluginPanel
{
	private final DMMFlipperPlugin plugin;
	private final PriceApiClient priceApiClient;
	private final GEOfferTracker geOfferTracker;
	private final FlipHistory flipHistory;
	private final DMMFlipperConfig config;

	private final JPanel opportunitiesPanel;
	private final JPanel activeFlippingPanel;
	private final JPanel bulkOpportunitiesPanel;
	private final JPanel overnightFlippingPanel;
	private final JPanel offersPanel;
	private final JPanel statsPanel;
	private final JButton refreshButton;
	private final JLabel sessionProfitLabel;
	private final JLabel totalProfitLabel;

	public DMMFlipperPanel(DMMFlipperPlugin plugin, PriceApiClient priceApiClient, 
						   GEOfferTracker geOfferTracker, FlipHistory flipHistory, DMMFlipperConfig config)
	{
		super(false);
		this.plugin = plugin;
		this.priceApiClient = priceApiClient;
		this.geOfferTracker = geOfferTracker;
		this.flipHistory = flipHistory;
		this.config = config;

		setLayout(new BorderLayout());
		setBackground(ColorScheme.DARK_GRAY_COLOR);

		// Header
		JPanel headerPanel = new JPanel(new BorderLayout());
		headerPanel.setBackground(ColorScheme.DARKER_GRAY_COLOR);
		headerPanel.setBorder(new EmptyBorder(10, 10, 10, 10));

		JPanel titlePanel = new JPanel(new GridLayout(3, 1));
		titlePanel.setBackground(ColorScheme.DARKER_GRAY_COLOR);

		JLabel titleLabel = new JLabel("DMM Flipper");
		titleLabel.setForeground(Color.WHITE);
		titleLabel.setFont(new Font("Arial", Font.BOLD, 16));
		
		sessionProfitLabel = new JLabel("Session: 0 gp");
		sessionProfitLabel.setForeground(Color.GREEN);
		sessionProfitLabel.setFont(new Font("Arial", Font.PLAIN, 11));
		
		totalProfitLabel = new JLabel("Total: 0 gp");
		totalProfitLabel.setForeground(Color.CYAN);
		totalProfitLabel.setFont(new Font("Arial", Font.PLAIN, 11));

		titlePanel.add(titleLabel);
		titlePanel.add(sessionProfitLabel);
		titlePanel.add(totalProfitLabel);

		headerPanel.add(titlePanel, BorderLayout.WEST);

		refreshButton = new JButton("Refresh");
		refreshButton.addActionListener(e -> refreshFlips());
		headerPanel.add(refreshButton, BorderLayout.EAST);

		add(headerPanel, BorderLayout.NORTH);

		// Main content with tabs
		JTabbedPane tabbedPane = new JTabbedPane();
		tabbedPane.setBackground(ColorScheme.DARK_GRAY_COLOR);

		// Best Margin tab
		opportunitiesPanel = new JPanel();
		opportunitiesPanel.setLayout(new BoxLayout(opportunitiesPanel, BoxLayout.Y_AXIS));
		opportunitiesPanel.setBackground(ColorScheme.DARK_GRAY_COLOR);
		
		JScrollPane opportunitiesScroll = new JScrollPane(opportunitiesPanel);
		opportunitiesScroll.setBackground(ColorScheme.DARK_GRAY_COLOR);
		tabbedPane.addTab("Best Margin", opportunitiesScroll);

		// Active Flipping tab
		activeFlippingPanel = new JPanel();
		activeFlippingPanel.setLayout(new BoxLayout(activeFlippingPanel, BoxLayout.Y_AXIS));
		activeFlippingPanel.setBackground(ColorScheme.DARK_GRAY_COLOR);
		
		JScrollPane activeFlippingScroll = new JScrollPane(activeFlippingPanel);
		activeFlippingScroll.setBackground(ColorScheme.DARK_GRAY_COLOR);
		tabbedPane.addTab("Active Flip", activeFlippingScroll);

		// Bulk Volume tab
		bulkOpportunitiesPanel = new JPanel();
		bulkOpportunitiesPanel.setLayout(new BoxLayout(bulkOpportunitiesPanel, BoxLayout.Y_AXIS));
		bulkOpportunitiesPanel.setBackground(ColorScheme.DARK_GRAY_COLOR);
		
		JScrollPane bulkOpportunitiesScroll = new JScrollPane(bulkOpportunitiesPanel);
		bulkOpportunitiesScroll.setBackground(ColorScheme.DARK_GRAY_COLOR);
		tabbedPane.addTab("Bulk Volume", bulkOpportunitiesScroll);

		// Overnight Flipping tab
		overnightFlippingPanel = new JPanel();
		overnightFlippingPanel.setLayout(new BoxLayout(overnightFlippingPanel, BoxLayout.Y_AXIS));
		overnightFlippingPanel.setBackground(ColorScheme.DARK_GRAY_COLOR);
		
		JScrollPane overnightFlippingScroll = new JScrollPane(overnightFlippingPanel);
		overnightFlippingScroll.setBackground(ColorScheme.DARK_GRAY_COLOR);
		tabbedPane.addTab("Overnight Flip", overnightFlippingScroll);

		// Active offers tab
		offersPanel = new JPanel();
		offersPanel.setLayout(new BoxLayout(offersPanel, BoxLayout.Y_AXIS));
		offersPanel.setBackground(ColorScheme.DARK_GRAY_COLOR);
		
		JScrollPane offersScroll = new JScrollPane(offersPanel);
		offersScroll.setBackground(ColorScheme.DARK_GRAY_COLOR);
		tabbedPane.addTab("Active Offers", offersScroll);

		// Statistics tab
		statsPanel = new JPanel();
		statsPanel.setLayout(new BoxLayout(statsPanel, BoxLayout.Y_AXIS));
		statsPanel.setBackground(ColorScheme.DARK_GRAY_COLOR);
		
		JScrollPane statsScroll = new JScrollPane(statsPanel);
		statsScroll.setBackground(ColorScheme.DARK_GRAY_COLOR);
		tabbedPane.addTab("Statistics", statsScroll);

		add(tabbedPane, BorderLayout.CENTER);

		// Initial load
		refreshFlips();
		updateProfitLabels();
	}

	private void refreshFlips()
	{
		SwingUtilities.invokeLater(() -> {
			refreshButton.setEnabled(false);
			refreshButton.setText("Loading...");
		});

		new Thread(() -> {
			try
			{
				List<FlipOpportunity> opportunities = priceApiClient.calculateOpportunities(
					config.minProfit(),
					config.minROI(),
					config.maxROI(),
					config.maxAge(),
					config.budget()
				);
				
				List<FlipOpportunity> activeFlippingOpportunities = priceApiClient.calculateActiveFlippingOpportunities(
					1,
					25000,
					config.maxAge(),
					config.budget()
				);
				
				List<FlipOpportunity> bulkOpportunities = priceApiClient.calculateBulkOpportunities(
					config.minProfit(),
					config.minROI(),
					config.maxROI(),
					config.maxAge(),
					config.budget(),
					1000
				);
				
				List<FlipOpportunity> overnightOpportunities = priceApiClient.calculateOvernightOpportunities(
					config.minProfit(),
					config.minROI(),
					config.maxROI(),
					config.maxAge(),
					config.budget()
				);

				SwingUtilities.invokeLater(() -> {
					updateOpportunitiesDisplay(opportunities);
					updateActiveFlippingDisplay(activeFlippingOpportunities);
					updateBulkOpportunitiesDisplay(bulkOpportunities);
					updateOvernightFlippingDisplay(overnightOpportunities);
					updateOfferDisplay();
					private JPanel createOvernightFlippingPanel(FlipOpportunity opp)
					{
						JPanel panel = new JPanel();
						panel.setLayout(new BorderLayout());
						panel.setBackground(ColorScheme.DARKER_GRAY_COLOR);
						panel.setBorder(new EmptyBorder(5, 5, 5, 5));

						JPanel infoPanel = new JPanel(new GridLayout(4, 1));
						infoPanel.setBackground(ColorScheme.DARKER_GRAY_COLOR);

						JLabel nameLabel = new JLabel(truncateName(opp.getItemName(), 25));
						nameLabel.setForeground(Color.WHITE);
						nameLabel.setFont(new Font("Arial", Font.BOLD, 12));

						// Calculate per-item profit from overnight total (divide by estimated cycles)
						int totalVolume = opp.getBuyVolume() + opp.getSellVolume();
						int estimatedCycles = totalVolume > 500 ? 3 : 2;
						int perItemProfit = opp.getProfit() / (opp.getLimit() * estimatedCycles);

						JLabel profitLabel = new JLabel(String.format("12h Total: %s gp (%s ea × %dx)",
							QuantityFormatter.formatNumber(opp.getProfit()),
							QuantityFormatter.formatNumber(perItemProfit),
							estimatedCycles));
						profitLabel.setForeground(Color.GREEN);

						JLabel priceLabel = new JLabel(String.format("Buy: %s → Sell: %s",
							QuantityFormatter.formatNumber(opp.getBuyPrice()),
							QuantityFormatter.formatNumber(opp.getSellPrice())));
						priceLabel.setForeground(Color.CYAN);

						JLabel detailLabel = new JLabel(String.format("Limit: %s | ROI: %.1f%% | Vol: %s",
							QuantityFormatter.formatNumber(opp.getLimit()),
							opp.getRoi(),
							QuantityFormatter.formatNumber(totalVolume)));
						detailLabel.setForeground(Color.LIGHT_GRAY);
						detailLabel.setFont(new Font("Arial", Font.PLAIN, 10));

						infoPanel.add(nameLabel);
						infoPanel.add(profitLabel);
						infoPanel.add(priceLabel);
						infoPanel.add(detailLabel);

						panel.add(infoPanel, BorderLayout.CENTER);

						return panel;
					}

					public void updateOfferDisplay()
					updateStatsDisplay();
					updateProfitLabels();
					refreshButton.setEnabled(true);
					refreshButton.setText("Refresh");
				});
			}
			catch (Exception e)
			{
				log.error("Error refreshing flips", e);
				SwingUtilities.invokeLater(() -> {
					refreshButton.setEnabled(true);
					refreshButton.setText("Refresh");
				});
			}
		}).start();
	}

	private void updateOpportunitiesDisplay(List<FlipOpportunity> opportunities)
	{
		opportunitiesPanel.removeAll();

		if (opportunities.isEmpty())
		{
			JLabel noDataLabel = new JLabel("No flips found. Check your filters.");
			noDataLabel.setForeground(Color.LIGHT_GRAY);
			noDataLabel.setBorder(new EmptyBorder(10, 10, 10, 10));
			opportunitiesPanel.add(noDataLabel);
		}
		else
		{
			int count = Math.min(20, opportunities.size());
			for (int i = 0; i < count; i++)
			{
				FlipOpportunity opp = opportunities.get(i);
				opportunitiesPanel.add(createOpportunityPanel(opp));
				private void updateOvernightFlippingDisplay(List<FlipOpportunity> opportunities)
				{
					overnightFlippingPanel.removeAll();

					if (opportunities.isEmpty())
					{
						JLabel noDataLabel = new JLabel("No overnight flipping opportunities found.");
						noDataLabel.setForeground(Color.LIGHT_GRAY);
						noDataLabel.setBorder(new EmptyBorder(10, 10, 10, 10));
						overnightFlippingPanel.add(noDataLabel);
					}
					else
					{
						int count = Math.min(20, opportunities.size());
						for (int i = 0; i < count; i++)
						{
							FlipOpportunity opp = opportunities.get(i);
							overnightFlippingPanel.add(createOvernightFlippingPanel(opp));
						}
					}

					overnightFlippingPanel.revalidate();
					overnightFlippingPanel.repaint();
				}

				private JPanel createOpportunityPanel(FlipOpportunity opp)
			}
		}

		opportunitiesPanel.revalidate();
		opportunitiesPanel.repaint();
	}

	private void updateActiveFlippingDisplay(List<FlipOpportunity> opportunities)
	{
		activeFlippingPanel.removeAll();

		if (opportunities.isEmpty())
		{
			JLabel noDataLabel = new JLabel("No active flipping opportunities found.");
			noDataLabel.setForeground(Color.LIGHT_GRAY);
			noDataLabel.setBorder(new EmptyBorder(10, 10, 10, 10));
			activeFlippingPanel.add(noDataLabel);
		}
		else
		{
			int count = Math.min(30, opportunities.size());
			for (int i = 0; i < count; i++)
			{
				FlipOpportunity opp = opportunities.get(i);
				activeFlippingPanel.add(createActiveFlippingPanel(opp));
			}
		}

		activeFlippingPanel.revalidate();
		activeFlippingPanel.repaint();
	}

	private void updateBulkOpportunitiesDisplay(List<FlipOpportunity> opportunities)
	{
		bulkOpportunitiesPanel.removeAll();

		if (opportunities.isEmpty())
		{
			JLabel noDataLabel = new JLabel("No bulk opportunities found.");
			noDataLabel.setForeground(Color.LIGHT_GRAY);
			noDataLabel.setBorder(new EmptyBorder(10, 10, 10, 10));
			bulkOpportunitiesPanel.add(noDataLabel);
		}
		else
		{
			int count = Math.min(20, opportunities.size());
			for (int i = 0; i < count; i++)
			{
				FlipOpportunity opp = opportunities.get(i);
				bulkOpportunitiesPanel.add(createBulkOpportunityPanel(opp));
			}
		}

		bulkOpportunitiesPanel.revalidate();
		bulkOpportunitiesPanel.repaint();
	}

	private JPanel createOpportunityPanel(FlipOpportunity opp)
	{
		JPanel panel = new JPanel();
		panel.setLayout(new BorderLayout());
		panel.setBackground(ColorScheme.DARKER_GRAY_COLOR);
		panel.setBorder(new EmptyBorder(5, 5, 5, 5));

		JPanel infoPanel = new JPanel(new GridLayout(4, 1));
		infoPanel.setBackground(ColorScheme.DARKER_GRAY_COLOR);

		JLabel nameLabel = new JLabel(truncateName(opp.getItemName(), 25));
		nameLabel.setForeground(Color.WHITE);
		nameLabel.setFont(new Font("Arial", Font.BOLD, 12));

		JLabel profitLabel = new JLabel(String.format("Profit: %s gp", 
			QuantityFormatter.formatNumber(opp.getProfit())));
		profitLabel.setForeground(Color.GREEN);

		JLabel priceLabel = new JLabel(String.format("Buy: %s → Sell: %s", 
			QuantityFormatter.formatNumber(opp.getBuyPrice()),
			QuantityFormatter.formatNumber(opp.getSellPrice())));
		priceLabel.setForeground(Color.CYAN);

		JLabel detailLabel = new JLabel(String.format("Limit: %s | ROI: %.1f%% | Age: %dm",
			QuantityFormatter.formatNumber(opp.getLimit()),
			opp.getRoi(),
			opp.getAgeMinutes()));
		detailLabel.setForeground(Color.LIGHT_GRAY);
		detailLabel.setFont(new Font("Arial", Font.PLAIN, 10));

		infoPanel.add(nameLabel);
		infoPanel.add(profitLabel);
		infoPanel.add(priceLabel);
		infoPanel.add(detailLabel);

		panel.add(infoPanel, BorderLayout.CENTER);

		return panel;
	}

	private JPanel createActiveFlippingPanel(FlipOpportunity opp)
	{
		JPanel panel = new JPanel();
		panel.setLayout(new BorderLayout());
		panel.setBackground(ColorScheme.DARKER_GRAY_COLOR);
		panel.setBorder(new EmptyBorder(5, 5, 5, 5));

		JPanel infoPanel = new JPanel(new GridLayout(4, 1));
		infoPanel.setBackground(ColorScheme.DARKER_GRAY_COLOR);

		JLabel nameLabel = new JLabel(truncateName(opp.getItemName(), 25));
		nameLabel.setForeground(Color.WHITE);
		nameLabel.setFont(new Font("Arial", Font.BOLD, 12));

		int totalVolume = opp.getBuyVolume() + opp.getSellVolume();
		JLabel profitLabel = new JLabel(String.format("Margin: %s gp | Vol: %s", 
			QuantityFormatter.formatNumber(opp.getProfit()),
			QuantityFormatter.formatNumber(totalVolume)));
		profitLabel.setForeground(Color.GREEN);

		JLabel priceLabel = new JLabel(String.format("Buy: %s → Sell: %s", 
			QuantityFormatter.formatNumber(opp.getBuyPrice()),
			QuantityFormatter.formatNumber(opp.getSellPrice())));
		priceLabel.setForeground(Color.CYAN);

		String freshness = opp.getAgeMinutes() < 2 ? "FRESH" : opp.getAgeMinutes() < 5 ? "Recent" : "Old";
		Color freshnessColor = opp.getAgeMinutes() < 2 ? Color.GREEN : opp.getAgeMinutes() < 5 ? Color.YELLOW : Color.ORANGE;
		
		JLabel detailLabel = new JLabel(String.format("Limit: %s | ROI: %.1f%% | %s (%dm)",
			QuantityFormatter.formatNumber(opp.getLimit()),
			opp.getRoi(),
			freshness,
			opp.getAgeMinutes()));
		detailLabel.setForeground(freshnessColor);
		detailLabel.setFont(new Font("Arial", Font.PLAIN, 10));

		infoPanel.add(nameLabel);
		infoPanel.add(profitLabel);
		infoPanel.add(priceLabel);
		infoPanel.add(detailLabel);

		panel.add(infoPanel, BorderLayout.CENTER);

		return panel;
	}

	private JPanel createBulkOpportunityPanel(FlipOpportunity opp)
	{
		JPanel panel = new JPanel();
		panel.setLayout(new BorderLayout());
		panel.setBackground(ColorScheme.DARKER_GRAY_COLOR);
		panel.setBorder(new EmptyBorder(5, 5, 5, 5));

		JPanel infoPanel = new JPanel(new GridLayout(4, 1));
		infoPanel.setBackground(ColorScheme.DARKER_GRAY_COLOR);

		JLabel nameLabel = new JLabel(truncateName(opp.getItemName(), 25));
		nameLabel.setForeground(Color.WHITE);
		nameLabel.setFont(new Font("Arial", Font.BOLD, 12));

		int perItemProfit = opp.getProfit() / opp.getLimit();
		JLabel profitLabel = new JLabel(String.format("Total: %s gp (%s ea)", 
			QuantityFormatter.formatNumber(opp.getProfit()),
			QuantityFormatter.formatNumber(perItemProfit)));
		profitLabel.setForeground(Color.GREEN);

		JLabel priceLabel = new JLabel(String.format("Buy: %s → Sell: %s", 
			QuantityFormatter.formatNumber(opp.getBuyPrice()),
			QuantityFormatter.formatNumber(opp.getSellPrice())));
		priceLabel.setForeground(Color.CYAN);

		JLabel detailLabel = new JLabel(String.format("Limit: %s | ROI: %.1f%% | Age: %dm",
			QuantityFormatter.formatNumber(opp.getLimit()),
			opp.getRoi(),
			opp.getAgeMinutes()));
		detailLabel.setForeground(Color.LIGHT_GRAY);
		detailLabel.setFont(new Font("Arial", Font.PLAIN, 10));

		infoPanel.add(nameLabel);
		infoPanel.add(profitLabel);
		infoPanel.add(priceLabel);
		infoPanel.add(detailLabel);

		panel.add(infoPanel, BorderLayout.CENTER);

		return panel;
	}

	public void updateOfferDisplay()
	{
		SwingUtilities.invokeLater(() -> {
			offersPanel.removeAll();

			List<GEOfferTracker.TrackedOffer> offers = geOfferTracker.getActiveOffers();

			if (offers.isEmpty())
			{
				JLabel noOffersLabel = new JLabel("No active GE offers");
				noOffersLabel.setForeground(Color.LIGHT_GRAY);
				noOffersLabel.setBorder(new EmptyBorder(10, 10, 10, 10));
				offersPanel.add(noOffersLabel);
			}
			else
			{
				for (GEOfferTracker.TrackedOffer offer : offers)
				{
					offersPanel.add(createOfferPanel(offer));
				}
			}

			offersPanel.revalidate();
			offersPanel.repaint();
		});
	}

	private JPanel createOfferPanel(GEOfferTracker.TrackedOffer offer)
	{
		JPanel panel = new JPanel();
		panel.setLayout(new BorderLayout());
		panel.setBackground(ColorScheme.DARKER_GRAY_COLOR);
		panel.setBorder(new EmptyBorder(5, 5, 5, 5));

		ItemInfo itemInfo = priceApiClient.getItemInfo(offer.getItemId());
		String itemName = itemInfo != null ? itemInfo.getName() : "Item #" + offer.getItemId();

		JPanel infoPanel = new JPanel(new GridLayout(4, 1));
		infoPanel.setBackground(ColorScheme.DARKER_GRAY_COLOR);

		JLabel nameLabel = new JLabel(truncateName(itemName, 25));
		nameLabel.setForeground(Color.WHITE);
		nameLabel.setFont(new Font("Arial", Font.BOLD, 12));

		String type = offer.isBuying() ? "Buying" : "Selling";
		JLabel typeLabel = new JLabel(String.format("%s @ %s gp", 
			type,
			QuantityFormatter.formatNumber(offer.getPrice())));
		typeLabel.setForeground(offer.isBuying() ? Color.CYAN : Color.GREEN);

		JLabel qtyLabel = new JLabel(String.format("Qty: %d / %d", 
			offer.getQuantityFilled(),
			offer.getQuantity()));
		qtyLabel.setForeground(Color.LIGHT_GRAY);

		long ageSeconds = (System.currentTimeMillis() - offer.getTimestamp()) / 1000;
		JLabel ageLabel = new JLabel(String.format("Age: %dm", ageSeconds / 60));
		ageLabel.setForeground(Color.LIGHT_GRAY);
		ageLabel.setFont(new Font("Arial", Font.PLAIN, 10));

		infoPanel.add(nameLabel);
		infoPanel.add(typeLabel);
		infoPanel.add(qtyLabel);
		infoPanel.add(ageLabel);

		panel.add(infoPanel, BorderLayout.CENTER);

		return panel;
	}

	private void updateStatsDisplay()
	{
		statsPanel.removeAll();

		List<FlipHistory.CompletedFlip> allFlips = new ArrayList<>();
		for (List<FlipHistory.CompletedFlip> flips : flipHistory.getCompletedFlips().values())
		{
			allFlips.addAll(flips);
		}

		if (allFlips.isEmpty())
		{
			JLabel noDataLabel = new JLabel("No completed flips yet");
			noDataLabel.setForeground(Color.LIGHT_GRAY);
			noDataLabel.setBorder(new EmptyBorder(10, 10, 10, 10));
			statsPanel.add(noDataLabel);
		}
		else
		{
			allFlips.sort((a, b) -> Long.compare(b.getTimestamp(), a.getTimestamp()));
			
			int count = Math.min(20, allFlips.size());
			for (int i = 0; i < count; i++)
			{
				FlipHistory.CompletedFlip flip = allFlips.get(i);
				statsPanel.add(createFlipPanel(flip));
			}
		}

		statsPanel.revalidate();
		statsPanel.repaint();
	}

	private JPanel createFlipPanel(FlipHistory.CompletedFlip flip)
	{
		JPanel panel = new JPanel();
		panel.setLayout(new BorderLayout());
		panel.setBackground(ColorScheme.DARKER_GRAY_COLOR);
		panel.setBorder(new EmptyBorder(5, 5, 5, 5));

		JPanel infoPanel = new JPanel(new GridLayout(3, 1));
		infoPanel.setBackground(ColorScheme.DARKER_GRAY_COLOR);

		JLabel nameLabel = new JLabel(truncateName(flip.getItemName(), 25));
		nameLabel.setForeground(Color.WHITE);
		nameLabel.setFont(new Font("Arial", Font.BOLD, 12));

		JLabel profitLabel = new JLabel(String.format("Profit: %s gp", 
			QuantityFormatter.formatNumber(flip.getProfit())));
		profitLabel.setForeground(flip.getProfit() > 0 ? Color.GREEN : Color.RED);

		JLabel detailLabel = new JLabel(String.format("Buy: %s | Sell: %s | Qty: %d",
			QuantityFormatter.formatNumber(flip.getBuyPrice()),
			QuantityFormatter.formatNumber(flip.getSellPrice()),
			flip.getQuantity()));
		detailLabel.setForeground(Color.LIGHT_GRAY);
		detailLabel.setFont(new Font("Arial", Font.PLAIN, 10));

		infoPanel.add(nameLabel);
		infoPanel.add(profitLabel);
		infoPanel.add(detailLabel);

		panel.add(infoPanel, BorderLayout.CENTER);

		return panel;
	}

	public void updateProfitLabels()
	{
		int sessionProfit = flipHistory.getSessionProfit();
		int totalProfit = flipHistory.getTotalProfit();

		sessionProfitLabel.setText(String.format("Session: %s gp", QuantityFormatter.formatNumber(sessionProfit)));
		totalProfitLabel.setText(String.format("Total: %s gp", QuantityFormatter.formatNumber(totalProfit)));
	}

	private void addDetailLabel(JPanel panel, String label, String value)
	{
		JLabel keyLabel = new JLabel(label);
		keyLabel.setForeground(Color.LIGHT_GRAY);
		keyLabel.setFont(new Font("Arial", Font.PLAIN, 11));

		JLabel valueLabel = new JLabel(value);
		valueLabel.setForeground(Color.WHITE);
		valueLabel.setFont(new Font("Arial", Font.PLAIN, 11));

		panel.add(keyLabel);
		panel.add(valueLabel);
	}

	private String truncateName(String name, int maxLength)
	{
		if (name.length() <= maxLength)
		{
			return name;
		}
		return name.substring(0, maxLength - 2) + "..";
	}
}
